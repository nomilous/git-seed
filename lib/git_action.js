// Generated by CoffeeScript 1.4.0
var GitAction, GitTree, colors;

colors = require('colors');

GitTree = require('./git_tree');

module.exports = GitAction = {
  isError: function() {
    return error === '';
  },
  showError: function() {
    return console.log(GitAction.error);
  },
  error: 'unknown or missing command',
  assign: function(program) {
    GitAction.root = program.root || '.';
    GitAction.message = program.message;
    return GitAction;
  },
  init: function() {
    var arrayOfGitWorkdirs, find, list;
    console.log('(init)'.bold, 'scanning for git repositories in', GitAction.root, '\n');
    GitAction.error = '';
    list = {};
    arrayOfGitWorkdirs = [];
    find = require('findit').find(GitAction.root);
    find.on('end', function() {
      var tree;
      tree = GitTree.init(GitAction.root, arrayOfGitWorkdirs);
      return tree.save();
    });
    return find.on('directory', function(dir, stat) {
      var match;
      if (match = dir.match(/(.*)\/.git\//)) {
        if (typeof list[match[1]] !== 'undefined') {
          return;
        }
        console.log('(found)'.green, "" + match[1] + "/.git");
        list[match[1]] = 1;
        return arrayOfGitWorkdirs.push(match[1]);
      }
    });
  },
  status: function() {
    console.log('(status)'.bold, 'for all expected repositories in', GitAction.root, '\n');
    GitAction.error = '';
    return (new GitTree(GitAction.root)).status();
  },
  commit: function() {
    GitAction.error = '';
    return console.log('commit with', GitAction.message);
  },
  push: function() {
    return GitAction.error = '';
  },
  pull: function() {
    return GitAction.error = '';
  }
};
