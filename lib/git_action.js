// Generated by CoffeeScript 1.4.0
var GitAction, GitSeed, colors, fs, w;

colors = require('colors');

console.log('remove colors');

GitSeed = require('nezkit').seed;

fs = require('fs');

w = require('when');

module.exports = GitAction = {
  gotDirectory: function(directory) {
    try {
      return fs.lstatSync(directory).isDirectory();
    } catch (error) {
      return false;
    }
  },
  isError: function() {
    return error === '';
  },
  showError: function() {
    return console.log(GitAction.error);
  },
  error: 'unknown or missing command',
  assign: function() {
    return GitAction.configure;
  },
  configure: function(program, onSuccess, onError, onNotify) {
    var plugin;
    if (typeof onSuccess === 'undefined' || typeof onError === 'undefined') {
      throw new Error('requires promise handlers');
    }
    GitAction.deferral = w.defer();
    GitAction.deferral.notify = onNotify;
    GitAction.deferral.promise.then(onSuccess, onError, onNotify);
    GitAction.root = '.';
    GitAction.message = program.message;
    plugin = program.packageManager || 'npm';
    try {
      GitAction.plugin = require("git-seed-" + plugin);
    } catch (error) {
      onNotify.event.bad('missing plugin', error.toString());
      process.exit(1);
    }
    return GitAction;
  },
  init: function() {
    if (typeof GitAction.deferral === 'undefined') {
      throw new Error('configure() was not called');
    }
    GitAction.deferral.notify.event.good('start seed init', "recurse for git repositories in '" + GitAction.root + "'");
    GitAction.error = '';
    if (!GitAction.gotDirectory(GitAction.root + '/.git')) {
      GitAction.deferral.notify.event.bad('missing root repo', "no git reposititory in '" + GitAction.root + "'");
      return;
    }
    return GitSeed.init(GitAction.root, GitAction.plugin, GitAction.deferral);
  },
  status: function() {
    if (typeof GitAction.deferral === 'undefined') {
      throw new Error('configure() was not called');
    }
    GitAction.deferral.notify.event.good('start seed status', "for all git repositories in '" + GitAction.root + "/.git-seed'");
    return GitAction.error = '';
  },
  clone: function() {
    if (typeof GitAction.deferral === 'undefined') {
      throw new Error('configure() was not called');
    }
    GitAction.deferral.notify.event.good('start seed clone', "for all git repositories in '" + GitAction.root + "/.git-seed'");
    return GitAction.error = '';
  },
  commit: function() {
    if (typeof GitAction.deferral === 'undefined') {
      throw new Error('configure() was not called');
    }
    GitAction.deferral.notify.event.good('start seed commit', "for any git repositories with staged changes in '" + GitAction.root + "/.git-seed' ");
    return GitAction.error = '';
  },
  pull: function() {
    if (typeof GitAction.deferral === 'undefined') {
      throw new Error('configure() was not called');
    }
    GitAction.deferral.notify.event.good('start seed pull', "for all git repositories in '" + GitAction.root + "/.git-seed'");
    return GitAction.error = '';
  }
};
